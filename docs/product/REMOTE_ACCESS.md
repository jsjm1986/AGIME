# 远程访问指南

> **随时随地访问你的 AI 助手** — AGIME 支持局域网直连与云端隧道两种模式，让团队协作突破物理限制。

---

## 远程访问模式

AGIME 提供两种远程访问方案，满足不同场景需求：

###  1. LAN 连接（局域网模式）
**适用场景**：同一办公室/家庭网络内的设备互连

- ✅ **零延迟**：局域网内点对点直连，响应速度最快
- ✅ **零成本**：无需购买云服务或域名
- ✅ **高安全**：数据完全不出本地网络

### 2. Tunnel 隧道（远程模式）
**适用场景**：跨网络/跨地域的远程访问

- ✅ **无公网 IP 要求**：通过 Cloudflare Tunnel 穿透 NAT
- ✅ **全球加速**：Cloudflare 边缘节点提供低延迟
- ✅ **HTTPS 加密**：全程 TLS 加密传输

---

## 快速开始：LAN 连接

### 场景：小型团队办公室协作

**目标**：让同事 B 访问同事 A 电脑上运行的 AGIME

#### Host 端配置（同事 A）

1. **启用 LAN 共享**
   - 打开 AGIME → 设置 → 团队 → LAN 共享
   - 开启"允许局域网访问"
   - 记录以下信息：
     - **IP 地址**: `192.168.1.100`
     - **端口**: `7778`
     - **Secret Key**: `abc123xyz...`（系统自动生成）

2. **防火墙配置**
   ```bash
   # Windows
   允许 AGIME 通过防火墙（安装时自动配置）
   
   # macOS
   系统偏好设置 → 安全性与隐私 → 防火墙 → 允许 AGIME
   ```

3. **分享连接信息**
   将以下信息通过微信/钉钉发送给同事 B：
   ```
   Host: 192.168.1.100
   Port: 7778
   Secret Key: abc123xyz...
   ```

#### Client 端配置（同事 B）

1. **添加 LAN 连接**
   - 打开 AGIME → 团队 → LAN 连接
   - 点击"添加连接"
   - 填写信息：
     - **Host**: `192.168.1.100`
     - **Port**: `7778`
     - **Secret Key**: `abc123xyz...`（从同事 A 获取）
     - **名称**: `同事A - 主力机`（可选）

2. **连接验证**
   - 点击"测试连接" → 显示绿色"连接成功"
   - 点击"浏览团队" → 查看同事 A 共享的 Skills/Recipes

---

## 高级：Tunnel 远程访问

### 场景：出差/居家办公访问公司 AGIME

**目标**：在家中通过互联网访问公司电脑上的 AGIME

#### 前提条件

桌面端 AGIME 自动集成 **Cloudflared**，无需手动安装。

#### 启动 Tunnel

1. **开启远程访问**
   - 打开 AGIME → 设置 → 应用 → 远程访问
   - 点击"启动隧道"
   - 等待 10-20 秒，系统自动生成访问链接

2. **获取访问链接**
   ```
   https://abc-def-ghi.trycloudflare.com/web/#secret=YOUR_SECRET_KEY
   ```
   - ⚠️ **重要**：此链接包含密钥，仅分享给可信任的人
   - 链接有效期：隧道关闭前一直有效

#### 远程访问

1. **在任意设备打开浏览器**
   - 访问上述链接
   - 自动进入 AGIME Web 界面

2. **体验说明**
   - 功能：完整的聊天、文件上传、MCP 扩展
   - 限制：无法执行系统级命令（出于安全考虑）

3. **关闭隧道**
   - 回到桌面端 AGIME
   - 设置 → 应用 → 远程访问 → "停止隧道"
   - 链接立即失效

---

## 实战场景

### 场景 1：移动办公

**需求**：出差时需要访问办公室电脑上的 AGIME，继续未完成的数据分析任务。

**方案**：
1. 出差前，在办公室电脑启动 Tunnel
2. 将访问链接发送到自己的手机/iPad
3. 在高铁/酒店通过浏览器继续工作
4. 回到办公室后，关闭 Tunnel

**优势**：
- 数据不离开公司电脑（本地文件/数据库）
- 无需额外配置 VPN 或远程桌面

---

### 场景 2：技术支持

**需求**：IT 管理员需要远程协助同事排查 AGIME 配置问题。

**方案**：
1. 同事在本地 AGIME 启动 Tunnel
2. 将链接通过企业 IM 发送给 IT 管理员
3. IT 在浏览器中查看配置、运行诊断命令
4. 问题解决后，同事关闭 Tunnel

---

### 场景 3：异地团队协作

**需求**：北京团队要共享一个训练好的 AI Skill 给上海团队。

**方案**：
1. **LAN 模式**（同办公室内部）：
   - 北京办公室内 5 台电脑通过 LAN 连接共享
   - 上海团队独立使用 LAN 连接

2. **Tunnel 模式**（跨地域）：
   - 北京主机启动 Tunnel
   - 上海团队通过浏览器访问，下载 Skill 到本地

---

## 安全最佳实践

### Secret Key 管理

1. **定期轮换**
   - 建议每月重新生成 Secret Key
   - 路径：设置 → 团队 → LAN 共享 → 重新生成密钥

2. **分级共享**
   - 核心团队：分享完整的 LAN 连接信息
   - 临时协作者：仅分享单次 Tunnel 链接

### 网络隔离

1. **LAN 连接防护**
   ```
   仅在企业内网开启 LAN 共享
   咖啡厅/公共 Wi-Fi 环境下务必关闭
   ```

2. **Tunnel 限制**
   ```
   仅在需要时启动
   完成工作后立即关闭
   避免长期开放造成安全隐患
   ```

---

## 故障排查

### LAN 连接失败

**症状**：点击"测试连接"显示超时

**排查步骤**：
1. ✅ 确认 Host 和 Client 在同一局域网
   ```bash
   # 在 Client 电脑 ping Host IP
   ping 192.168.1.100
   ```

2. ✅ 检查防火墙
   - Host 端：允许端口 7778（默认）
   - Client 端：允许出站连接

3. ✅ 验证 Secret Key
   - 确保粘贴时没有多余空格
   - 区分大小写

### Tunnel 无法启动

**症状**：点击"启动隧道"后一直显示"启动中"

**排查步骤**：
1. ✅ 检查网络连接
   - 确保能访问外网（Cloudflare 服务）

2. ✅ 重启 AGIME
   - 完全退出应用
   - 重新启动并再次尝试

3. ✅ 查看日志
   - 帮助 → 打开日志目录
   - 查找 `cloudflared.log` 中的错误信息

---

## 性能对比

| 维度 | LAN 连接 | Tunnel 隧道 |
|:---|:---:|:---:|
| **响应延迟** | < 10ms | 50-200ms |
| **带宽消耗** | 局域网内部，几乎无限制 | 依赖公网带宽 |
| **数据传输** | 完全本地 | 经过 Cloudflare CDN |
| **配置难度** | 简单（仅需 IP + 端口） | 自动化（一键启动） |
| **适用场景** | 同一网络环境 | 跨网络/跨地域 |

---

## 常见问题

### Q: LAN 连接和 Tunnel 可以同时使用吗？
**A**: 可以。两种模式互不影响，可以在办公室通过 LAN 连接同事电脑，同时开启 Tunnel 供远程访问。

### Q: Tunnel 链接会暴露我的电脑地址吗？
**A**: 不会。Cloudflare Tunnel 会隐藏您的真实 IP，外部只能看到 Cloudflare 的边缘节点地址。

### Q: 长期开启 Tunnel 是否安全？
**A**: 技术上安全（有 Secret Key 保护），但建议遵循"最小权限原则"，仅在需要时开启。

### Q: 团队成员离职后如何撤销访问权限？
**A**: 
1. LAN 连接：重新生成 Secret Key
2. Tunnel：关闭隧道并重新生成新链接

---

## 企业部署建议

### 中小型团队（< 20人）
- **推荐方案**: LAN 连接为主，Tunnel 为辅
- **成本**: 零额外成本
- **维护**: 低

### 大型企业（20-200人）
- **推荐方案**: 部署私有 AGIME Server（参考 [部署文档](DEPLOY.md)）
- **优势**: 集中管理、审计日志、权限控制
- **成本**: 需购买服务器

### 特殊行业（金融/医疗）
- **强制要求**: 数据不出内网
- **方案**: 仅使用 LAN 连接，禁用 Tunnel
- **配置**: 企业 IT 通过组策略禁用远程访问功能
